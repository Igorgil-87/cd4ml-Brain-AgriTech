<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projeto Cezargina - Engenharia de ML Agro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Nunito', sans-serif;
      background: url('fundo.webp') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Splash Screen */
    #splash {
      position: fixed;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      transition: opacity 0.8s ease;
    }
    #splash img {
      width: 80px;
      margin-bottom: 20px;
    }
    #splash h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
    }
    #splash p {
      font-size: 1rem;
      color: #ccc;
    }

    header {
      background: rgba(0, 0, 0, 0.6);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
      backdrop-filter: blur(6px);
    }

    .header-left {
      display: flex;
      align-items: center;
    }
    header img { height: 40px; margin-right: 12px; }
    header h1.title {
      font-size: 1.2rem; font-weight: 600; color: #fff;
    }
    header p.subtitle {
      font-size: 0.9rem; font-weight: 300; color: #f0f0f0; margin-top: 2px;
    }
    .header-right a {
      margin-left: 15px;
      color: white;
      text-decoration: none;
      font-size: 1.2rem;
    }
    .header-right a:hover { color: #ffdada; }

    .alert-button {
      background: none;
      border: none;
      color: white;
      position: relative;
      font-size: 1.4rem;
      cursor: pointer;
    }
    .alert-count {
      position: absolute;
      top: -6px;
      right: -8px;
      background: #e60000;
      color: white;
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 50%;
    }
    .alert-popup {
      display: none;
      position: absolute;
      top: 40px;
      right: 0;
      background: white;
      color: #333;
      width: 260px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 15px;
      z-index: 999;
    }
    .alert-popup h4 {
      margin-bottom: 10px;
      color: #e60000;
    }
    .alert-popup ul { list-style: none; padding-left: 0; }
    .alert-popup li {
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    nav {
      width: 220px;
      background: rgba(0, 0, 0, 0.75);
      border-right: 1px solid #333;
      color: white;
      overflow-y: auto;
    }
    nav ul { list-style: none; padding: 0; }
    nav li a {
      display: flex;
      align-items: center;
      padding: 15px;
      color: white;
      text-decoration: none;
      border-bottom: 1px solid #444;
      transition: background 0.2s;
    }
    nav li a:hover { background: rgba(255,255,255,0.1); }
    nav i { margin-right: 10px; }

    main {
      flex: 1;
      background: rgba(255,255,255,0.95);
      padding: 20px;
      overflow-y: auto;
    }
    .iframe-wrapper {
      width: 100%;
      height: calc(100vh - 100px);
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .dashboard-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .dashboard-card h3 { margin-bottom: 15px; color: #e60000; }
    canvas { width: 100%; height: 200px !important; }
    .error-msg {
      padding: 20px;
      color: #b30000;
      background: #ffe6e6;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash">
    <img src="santander.gif" alt="Santander">
    <h1>Projeto Cezargina</h1>
    <p>Engenharia de ML para o Agronegócio</p>
  </div>

  <!-- Interface Principal -->
  <header>
    <div class="header-left">
      <img src="santander.gif" alt="Santander">
      <div>
        <h1 class="title">Projeto Cezargina</h1>
        <p class="subtitle">Engenharia de ML para o Agronegócio</p>
      </div>
    </div>
    <div class="header-right">
      <a href="https://github.com/Igorgil-87/cd4ml-Brain-AgriTech" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
      <a href="http://localhost:8081/browser/" target="_blank" title="Lake"><i class="fas fa-database"></i></a>
      <a href="http://localhost:10000/blue" target="_blank" title="Jenkins CI/CD"><i class="fas fa-sync"></i></a>
      <a href="http://localhost:8888/lab" target="_blank" title="Jupyter"><i class="fas fa-book"></i></a>
      <button class="alert-button" onclick="toggleAlerts()" title="Alertas do Sistema">
        <i class="fas fa-bell"></i>
        <span class="alert-count" id="alert-count">3</span>
      </button>
      <div class="alert-popup" id="alert-popup">
        <h4>Alertas do Sistema</h4>
        <ul>
          <li>Pipeline de insumos falhou às 06:45</li>
          <li>Drift no modelo de rendimento (+12%)</li>
          <li>Erro de autenticação no Lake</li>
        </ul>
      </div>
    </div>
  </header>

  <div class="container">
    <nav>
      <ul>
        <li><a href="#" onclick="loadDashboard()"><i class="fas fa-chart-pie"></i> Dashboard</a></li>
        <li><a href="#" onclick="loadIframe('http://localhost:5601')"><i class="fas fa-chart-line"></i> Monitor</a></li>
        <li><a href="#" onclick="loadIframe('http://localhost:12000')"><i class="fas fa-robot"></i> MLflow</a></li>
        <li><a href="#" onclick="loadIframe('http://localhost:9000')"><i class="fas fa-box"></i> Storage</a></li>
        <li><a href="#" onclick="loadIframe('http://localhost:11000')"><i class="fas fa-brain"></i> ML Model</a></li>
        <li><a href="#" onclick="loadIframe('http://localhost:8083/dags/pipeline_carregamento_agro_por_tabela/grid?root=')"><i class="fas fa-microchip"></i> Flow Data</a></li>
      </ul>
    </nav>
    <main id="main-content"></main>
  </div>

  <script>
    function toggleAlerts() {
      const popup = document.getElementById('alert-popup');
      popup.style.display = (popup.style.display === 'block') ? 'none' : 'block';
    }

    window.onclick = function(e) {
      const popup = document.getElementById('alert-popup');
      if (!e.target.closest('.alert-button') && !e.target.closest('#alert-popup')) {
        popup.style.display = 'none';
      }
    }

    function loadDashboard() {
      const dashboardHTML = `
        <div class="dashboard-grid" id="dashboard">
          <div class="dashboard-card"><h3>Volume no Bucket (MinIO)</h3><canvas id="bucketChart"></canvas></div>
          <div class="dashboard-card"><h3>Data Drift</h3><canvas id="driftChart"></canvas></div>
          <div class="dashboard-card"><h3>Acurácia dos Modelos</h3><canvas id="accuracyChart"></canvas></div>
          <div class="dashboard-card"><h3>Saúde da Lavoura</h3><div class="placeholder">NDVI Médio: <strong>0.79</strong> (Bom)</div></div>
          <div class="dashboard-card"><h3>Logs de Pipeline</h3><div class="placeholder">Última execução: <strong>03/06 - 18h12</strong> (sucesso)</div></div>
        </div>`;
      document.getElementById('main-content').innerHTML = dashboardHTML;
      loadCharts();
    }

    function loadIframe(url) {
      const iframeHTML = `
        <div class="iframe-wrapper">
          <iframe src="${url}" onerror="this.parentNode.innerHTML='<div class=error-msg>Não foi possível carregar: ${url}</div>';"></iframe>
        </div>`;
      document.getElementById('main-content').innerHTML = iframeHTML;
    }

    function loadCharts() {
      new Chart(document.getElementById('bucketChart'), {
        type: 'doughnut',
        data: { labels: ['Usado', 'Livre'], datasets: [{ data: [400, 600], backgroundColor: ['#e60000', '#ccc'] }] }
      });
      new Chart(document.getElementById('driftChart'), {
        type: 'bar',
        data: { labels: ['Mai', 'Jun'], datasets: [{ label: 'Data Drift (%)', data: [12, 15], backgroundColor: '#e60000' }] }
      });
      new Chart(document.getElementById('accuracyChart'), {
        type: 'line',
        data: { labels: ['Modelo 1', 'Modelo 2', 'Rendimento'], datasets: [{ label: 'Acurácia (%)', data: [88, 91.3, 93], fill: false, borderColor: '#e60000', tension: 0.1 }] }
      });
    }

    // Splash e carregamento inicial
    window.onload = () => {
      setTimeout(() => {
        document.getElementById('splash').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('splash').style.display = 'none';
          loadDashboard();
        }, 800);
      }, 3000);
    }
  </script>
</body>
</html>