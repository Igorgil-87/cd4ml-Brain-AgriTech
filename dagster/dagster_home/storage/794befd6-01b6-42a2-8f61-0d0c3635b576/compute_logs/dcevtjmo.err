2025-06-15 17:48:53 +0000 - dagster - DEBUG - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - 2856 - LOGS_CAPTURED - Started capturing logs in process (pid: 2856).
2025-06-15 17:48:53 +0000 - dagster - DEBUG - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - 2856 - train_rendimento_model - STEP_START - Started execution of step "train_rendimento_model".
2025-06-15 17:48:53 +0000 - dagster - DEBUG - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - train_rendimento_model - Loading file from: /opt/dagster/dagster_home/storage/794befd6-01b6-42a2-8f61-0d0c3635b576/preprocess_rendimento/result using PickledObjectFilesystemIOManager...
2025-06-15 17:48:54 +0000 - dagster - DEBUG - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - 2856 - train_rendimento_model - LOADED_INPUT - Loaded input "df" using input manager "io_manager", from output "result" of step "preprocess_rendimento"
2025-06-15 17:48:54 +0000 - dagster - DEBUG - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - 2856 - train_rendimento_model - STEP_INPUT - Got input "df" of type "DataFrame". (Type check passed).
2025-06-15 17:48:54 +0000 - dagster - INFO - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - train_rendimento_model - üîó MLflow Tracking URI: http://mlflow:5000
2025-06-15 17:48:54 +0000 - dagster - INFO - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - train_rendimento_model - ü™£ MLflow S3 Endpoint: http://minio:9000
2025-06-15 17:48:54 +0000 - dagster - INFO - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - train_rendimento_model - üóÉÔ∏è MLflow Backend Store URI: postgresql+psycopg2://agro_user:agro_password@postgres:5432/brain_agro
2025-06-15 17:49:55 +0000 - dagster - ERROR - rendimento_job - 794befd6-01b6-42a2-8f61-0d0c3635b576 - 2856 - train_rendimento_model - STEP_FAILURE - Execution of step "train_rendimento_model" failed.

dagster._core.errors.DagsterExecutionStepExecutionError: Error occurred while executing op "train_rendimento_model"::

mlflow.exceptions.MlflowException: API request to http://mlflow:5000/api/2.0/mlflow/experiments/get-by-name failed with exception HTTPConnectionPool(host='mlflow', port=5000): Max retries exceeded with url: /api/2.0/mlflow/experiments/get-by-name?experiment_name=rendimento_model (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff5a8ef640>: Failed to establish a new connection: [Errno 111] Connection refused'))

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/utils.py", line 54, in op_execution_error_boundary
    yield
  File "/usr/local/lib/python3.10/site-packages/dagster/_utils/__init__.py", line 467, in iterate_with_context
    next_output = next(iterator)
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/compute_generator.py", line 131, in _coerce_op_compute_fn_to_iterator
    result = invoke_compute_fn(
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/compute_generator.py", line 125, in invoke_compute_fn
    return fn(context, **args_to_pass) if context_arg_provided else fn(**args_to_pass)
  File "/opt/dagster/app/cd4ml_pipeline/ops/rendimento_ops.py", line 38, in train_rendimento_model
    with start_run("rendimento_model") as run:
  File "/opt/dagster/app/cd4ml_pipeline/shared/mlflow_utils.py", line 30, in start_run
    mlflow.set_experiment(name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/fluent.py", line 112, in set_experiment
    experiment = client.get_experiment_by_name(experiment_name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/client.py", line 451, in get_experiment_by_name
    return self._tracking_client.get_experiment_by_name(name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/_tracking_service/client.py", line 220, in get_experiment_by_name
    return self.store.get_experiment_by_name(name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/store/tracking/rest_store.py", line 304, in get_experiment_by_name
    response_proto = self._call_endpoint(GetExperimentByName, req_body)
  File "/usr/local/lib/python3.10/site-packages/mlflow/store/tracking/rest_store.py", line 56, in _call_endpoint
    return call_endpoint(self.get_host_creds(), endpoint, method, json_body, response_proto)
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 274, in call_endpoint
    response = http_request(
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 185, in http_request
    raise MlflowException(f"API request to {url} failed with exception {e}")

The above exception occurred during handling of the following exception:
requests.exceptions.ConnectionError: HTTPConnectionPool(host='mlflow', port=5000): Max retries exceeded with url: /api/2.0/mlflow/experiments/get-by-name?experiment_name=rendimento_model (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff5a8ef640>: Failed to establish a new connection: [Errno 111] Connection refused'))

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 167, in http_request
    return _get_http_response_with_retries(
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 98, in _get_http_response_with_retries
    return session.request(method, url, **kwargs)
  File "/usr/local/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/local/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/usr/local/lib/python3.10/site-packages/requests/adapters.py", line 700, in send
    raise ConnectionError(e, request=request)

The above exception occurred during handling of the following exception:
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='mlflow', port=5000): Max retries exceeded with url: /api/2.0/mlflow/experiments/get-by-name?experiment_name=rendimento_model (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff5a8ef640>: Failed to establish a new connection: [Errno 111] Connection refused'))

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 830, in urlopen
    return self.urlopen(
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 830, in urlopen
    return self.urlopen(
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 830, in urlopen
    return self.urlopen(
  [Previous line repeated 2 more times]
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 802, in urlopen
    retries = retries.increment(
  File "/usr/local/lib/python3.10/site-packages/urllib3/util/retry.py", line 594, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))

The above exception occurred during handling of the following exception:
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0xffff5a8ef640>: Failed to establish a new connection: [Errno 111] Connection refused

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 716, in urlopen
    httplib_response = self._make_request(
  File "/usr/local/lib/python3.10/site-packages/urllib3/connectionpool.py", line 416, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/usr/local/lib/python3.10/site-packages/urllib3/connection.py", line 244, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/usr/local/lib/python3.10/http/client.py", line 1283, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/usr/local/lib/python3.10/http/client.py", line 1329, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.10/http/client.py", line 1278, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.10/http/client.py", line 1038, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.10/http/client.py", line 976, in send
    self.connect()
  File "/usr/local/lib/python3.10/site-packages/urllib3/connection.py", line 205, in connect
    conn = self._new_conn()
  File "/usr/local/lib/python3.10/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(

The above exception occurred during handling of the following exception:
ConnectionRefusedError: [Errno 111] Connection refused

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/usr/local/lib/python3.10/site-packages/urllib3/util/connection.py", line 95, in create_connection
    raise err
  File "/usr/local/lib/python3.10/site-packages/urllib3/util/connection.py", line 85, in create_connection
    sock.connect(sa)

