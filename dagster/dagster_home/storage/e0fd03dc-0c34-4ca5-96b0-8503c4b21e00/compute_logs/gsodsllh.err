2025-06-18 12:38:41 +0000 - dagster - DEBUG - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - 71609 - LOGS_CAPTURED - Started capturing logs in process (pid: 71609).
2025-06-18 12:38:41 +0000 - dagster - DEBUG - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - 71609 - train_rendimento_model - STEP_START - Started execution of step "train_rendimento_model".
2025-06-18 12:38:41 +0000 - dagster - DEBUG - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - train_rendimento_model - Loading file from: /opt/dagster/dagster_home/storage/e0fd03dc-0c34-4ca5-96b0-8503c4b21e00/preprocess_rendimento/result using PickledObjectFilesystemIOManager...
2025-06-18 12:38:41 +0000 - dagster - DEBUG - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - 71609 - train_rendimento_model - LOADED_INPUT - Loaded input "df" using input manager "io_manager", from output "result" of step "preprocess_rendimento"
2025-06-18 12:38:41 +0000 - dagster - DEBUG - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - 71609 - train_rendimento_model - STEP_INPUT - Got input "df" of type "DataFrame". (Type check passed).
2025-06-18 12:38:41 +0000 - dagster - INFO - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - train_rendimento_model - üîó MLflow Tracking URI: http://mlflow:5000
2025-06-18 12:38:41 +0000 - dagster - INFO - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - train_rendimento_model - ü™£ MLflow S3 Endpoint: http://minio:9000
2025-06-18 12:38:42 +0000 - dagster - INFO - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - train_rendimento_model - üóÉÔ∏è MLflow Backend Store URI: postgresql+psycopg2://agro_user:agro_password@postgres:5432/brain_agro
2025-06-18 12:38:42 +0000 - dagster - ERROR - rendimento_job - e0fd03dc-0c34-4ca5-96b0-8503c4b21e00 - 71609 - train_rendimento_model - STEP_FAILURE - Execution of step "train_rendimento_model" failed.

dagster._core.errors.DagsterExecutionStepExecutionError: Error occurred while executing op "train_rendimento_model"::

mlflow.exceptions.RestException: BAD_REQUEST: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "tag_pk"
DETAIL:  Key (key, run_uuid)=(mlflow.runName, 2ff64f80cc3c4a81bbeb4f834cd1d481) already exists.

[SQL: INSERT INTO tags (key, value, run_uuid) VALUES (%(key)s, %(value)s, %(run_uuid)s)]
[parameters: ({'key': 'mlflow.user', 'value': 'root', 'run_uuid': '2ff64f80cc3c4a81bbeb4f834cd1d481'}, {'key': 'mlflow.source.name', 'value': '/usr/local/lib/python3.10/site-packages/dagster/__main__.py', 'run_uuid': '2ff64f80cc3c4a81bbeb4f834cd1d481'}, {'key': 'mlflow.source.type', 'value': 'LOCAL', 'run_uuid': '2ff64f80cc3c4a81bbeb4f834cd1d481'}, {'key': 'mlflow.runName', 'value': 'rendimento_model', 'run_uuid': '2ff64f80cc3c4a81bbeb4f834cd1d481'}, {'key': 'mlflow.runName', 'value': 'rendimento_model', 'run_uuid': '2ff64f80cc3c4a81bbeb4f834cd1d481'})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)

Stack Trace:
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/utils.py", line 54, in op_execution_error_boundary
    yield
  File "/usr/local/lib/python3.10/site-packages/dagster/_utils/__init__.py", line 467, in iterate_with_context
    next_output = next(iterator)
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/compute_generator.py", line 131, in _coerce_op_compute_fn_to_iterator
    result = invoke_compute_fn(
  File "/usr/local/lib/python3.10/site-packages/dagster/_core/execution/plan/compute_generator.py", line 125, in invoke_compute_fn
    return fn(context, **args_to_pass) if context_arg_provided else fn(**args_to_pass)
  File "/opt/dagster/app/cd4ml_pipeline/ops/rendimento_ops.py", line 31, in train_rendimento_model
    with start_run("rendimento_model") as run:
  File "/opt/dagster/app/cd4ml_pipeline/shared/mlflow_utils.py", line 33, in start_run
    return mlflow.start_run(run_name=name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/fluent.py", line 349, in start_run
    active_run_obj = client.create_run(
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/client.py", line 270, in create_run
    return self._tracking_client.create_run(experiment_id, start_time, tags, run_name)
  File "/usr/local/lib/python3.10/site-packages/mlflow/tracking/_tracking_service/client.py", line 131, in create_run
    return self.store.create_run(
  File "/usr/local/lib/python3.10/site-packages/mlflow/store/tracking/rest_store.py", line 175, in create_run
    response_proto = self._call_endpoint(CreateRun, req_body)
  File "/usr/local/lib/python3.10/site-packages/mlflow/store/tracking/rest_store.py", line 56, in _call_endpoint
    return call_endpoint(self.get_host_creds(), endpoint, method, json_body, response_proto)
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 281, in call_endpoint
    response = verify_rest_response(response, endpoint)
  File "/usr/local/lib/python3.10/site-packages/mlflow/utils/rest_utils.py", line 207, in verify_rest_response
    raise RestException(json.loads(response.text))

